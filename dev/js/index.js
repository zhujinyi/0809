!function(){function t(t){k.push(t),store.set("gg",k)}function e(){var t=$(".task-list");t.html(null);for(var e=[],a=0;a<k.length;a++)if(k[a].complated)e[a]=k[a];else{var c=n(k[a],a);t.append(c),f(c)}for(var l=0;l<e.length;l++)e[l]&&((c=n(e[l],l)).addClass("complated"),t.append(c));i(),s(),m()}function n(t,e){var n='<li data-index="'+e+'"><input type="checkbox" '+(t.complated?"checked":"")+'   class="complate"><p class="content">'+t.content+'</p><div class="right"><span class="delete r-main">删除</span><span class="detail r-main">详细</span></div></li>';return $(n)}function i(){$(".delete.r-main").click(function(){a($(this).parent().parent().data("index"))})}function a(t){var e=!1;$(".Alert").show(),$(".primary.confirm").bind("click",function(){e=!0,$(".Alert").hide(),e&&(k.splice(t,1),c(),$(".primary.confirm").unbind("click"))}),$(".cancel").click(function(){e=!1,$(".Alert").hide()})}function c(){store.set("gg",k),e()}function s(){$(".detail.r-main").click(function(){var t=$(this).parent().parent().data("index");l(k[t],t)})}function l(t,e){var n='<div class="task-detail-mask"></div><div class="task-detail"><form class="up-task"><h2 class="content">'+(t.content||"")+'</h2><div class="input-item"><input type="text" class="db-content"></div><div class="input-item"><textarea class="taile">'+(t.tatil||"")+'</textarea></div><div class="remind input-item"><label for="b">提醒时间</label><input id="b" class="datetime" type="text" value="'+(t.datetime||"")+'"></div><div class="input-item"><button class="ut-data">更新</button></div><div class="colse">X</div></form></div>';$(".container .task-list").after(n),$.datetimepicker.setLocale("ch"),$(".datetime").datetimepicker(),o(),d(e),r()}function o(){$(".task-detail-mask,.colse").click(function(){$(".task-detail-mask,.task-detail").remove()})}function d(t){$(".up-task").on("submit",function(n){n.preventDefault();var i={};i.content=$(this).find(".content").text(),i.tatil=$(this).find(".taile").val(),i.datetime=$(this).find(".datetime").val(),u(i,t),$(".task-detail-mask,.task-detail").remove(),e()})}function r(){$(".up-task .content").dblclick(function(){var t=$(this),e=$(".container .up-task .db-content");t.hide(),e.show(),e.val(t.text()),e.focus(),e.on("blur",function(){t.show(),e.hide(),e.val()&&t.text(e.val())})})}function u(t,e){k[e]=$.extend({},k[e],t),store.set("gg",k)}function m(){$(".task-list .complate").click(function(){var t=$(this).parent().data("index");k[t].complated?u({complated:!1},t):u({complated:!0},t),e()})}function f(t){$(t)[0]&&(clearInterval($(t)[0].timer),$(t)[0].timer=setTimeout(function(){for(var e=(new Date).getTime(),n=k,i=0;i<n.length;i++)n[i].complated||!n[i].datetime||n[i].off||new Date(n[i].datetime).getTime()-e<=1&&(clearInterval($(t)[0].timer),v(),p(k[i],i))},1e3))}function p(t,e){$(".msg").show(),$(".msg-content").text(t.content),$(".msg-btn").click(function(){u({off:!0,num:5},e),$(".msg").hide()})}function v(){document.getElementById("music").play()}var k=[],h=$(".add-task");k=store.get("gg")||[],e(),f(),h.on("submit",function(n){n.preventDefault();var i={};i.content=h.find("input").eq(0).val(),i.content&&(t(i),e(),h.find("input").eq(0).val(null))})}();